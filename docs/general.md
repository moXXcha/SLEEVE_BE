# AI エージェント向け開発ガイドライン

## Ⅰ. 基本的な役割

あなたは、堅牢で強固なシステムを開発する AI エージェントです。以下の手順と規約を厳守し、品質の高いコードを効率的に生成してください。

## Ⅱ. 作業手順

開発タスクは、以下の順序で厳密に進めてください。各ステップで作業者（人間）の確認と承認が必要です。

### 0. ドキュメントの完全読解

- **必須作業:** タスクを開始する前に、`docs/`ディレクトリ配下の全てのドキュメントを読み込み、プロジェクトの規約、アーキテクチャ、既存の決定事項を完全に理解してください。
- また、現ディレクトリの install されているモジュールなどを確認して重複して install が行われないようにしてください

### 1. 作業計画の策定と承認

- Markdown 形式で詳細な作業計画書を作成します。
- ファイル名は `docs/tasks/[JiraのID]_[タスク名]/task_plan.md` としてください。（例: `docs/tasks/PROJ-123_implementuser_auth/task_plan.md`）
- 特に、Jira チケットの受け入れ条件を基にした**テストの通過基準**を明確かつ詳細に記述してください。これが実装のゴールとなります。
- E2E テストが必要なタスクの場合、テストで使用する GraphQL リクエストの Header と Body の最適な内容を検討し、計画書に記載してください。
- **作業者への確認:** 計画書を作成したら、作業者に内容の確認を促してください。承認が得られたら、次のステップに進みます。
- db のテーブルに変更が必要な場合は docs/DB_manual.md の内容に従ってください。

### 2. テストの作成

作業計画書で定義した「テストの通過基準」と Jira チケットの「受け入れ条件」を基に、以下のテストを作成します。

#### 単体テスト

Go の標準テスト機能を使用し、UseCase 層や Repository 層のロジックを個別に検証するテストを作成します。

#### E2E テスト (Playwright)

Playwright と GraphQL クライアントライブラリを使用し、エンドツーエンドのテストを作成します。
主な手順は以下の通りです。

1. Playwright を使用してブラウザを起動し、GraphQL Playground にアクセスします。
2. Playground 上で、**作業計画書で定義した Header と Body を基に**、テスト対象の GraphQL クエリやミューテーションを実行します。
3. 返却されたレスポンスが、受け入れ条件を満たしていることを検証します。

**作業者への確認:** 全てのテストコード（単体・E2E）を書き終えたら、作業者に確認を促してください。承認が得られたら、次のステップに進みます。

### 3. 実装

- 作成したテストが全て通過するように、承認された作業計画に基づき実装を行います。
- `docs/BE_coding_roles.md` のコーディング規約を厳守してください。
- **メッセージの定義:** 実装で使用するエラーメッセージやログメッセージは、`docs/messages/` ディレクトリに日本語で記述し、コードからはそれを参照するようにしてください。これにより、メッセージの一元管理と統一性を保ちます。
- 作成が終わったら app/内で`golangci-lint run --fix`を実行して、linter の実行と format を行うこと

### 4. テストとデバッグ（こちらは task_procedure のテストとは別です。こちらはタスク終了寸前の結合、E2E テストのことです）

- 作成した単体テストおよび E2E テスト、結合テストを実行します。
- **テスト失敗時（実装中のデバッグ）:**
  1. **調査:** エラーの原因を調査します。
  2. **デバッグ調査書の作成:**
     - `docs/tasks/[JiraのID]_[タスク名]/debug.md` というファイル名で、調査内容とデバッグ方針を記録します。
     - （例: `docs/tasks/PROJ-123_implement_user_auth/debug.md`）
     - テンプレートは `docs/task_procedure.md` の「4.3 デバッグ調査書テンプレート」を参照してください。
  3. **作業者への確認:** デバッグ調査書を作成後、作業者に内容の確認を促し、承認を得てからデバッグ作業を行ってください。
  4. **繰り返し:** 全てのテストが成功するまで、このプロセスを繰り返します。

### 5. 実装詳細書の記載

- `docs/task_procedure.md` のテンプレートを参照して、実装詳細書の記載を行ってください

---

## Ⅲ. 関連ドキュメント

詳細な実装手順とテンプレートについては、以下のドキュメントを参照してください：

- **実装手順**: `docs/task_procedure.md` - 詳細な実装手順とテンプレート
- **コーディング規約**: `docs/BE_coding_roles.md` - アーキテクチャとコーディング規約
- **Git 運用**: `docs/github.md` - Git Flow 運用とコミット規約
- **DB 操作**: `docs/DB_manual.md` - データベース操作手順
- **Linter/Formatter**: `docs/lint_format_manual.md` - コード品質管理
